#!/bin/bash
# Ultra-simple Docker remote enabler - one-liner friendly
# Auto-detects Alpine Linux and handles sudo availability
set -e; echo "? Enabling Docker remote access..."; if command -v sudo >/dev/null 2>&1; then SUDO="sudo"; else SUDO=""; if [ "$(id -u)" != "0" ]; then echo "? Run as root or install sudo"; exit 1; fi; fi; $SUDO mkdir -p /etc/docker; echo '{"hosts":["unix:///var/run/docker.sock","tcp://0.0.0.0:2375"]}' | $SUDO tee /etc/docker/daemon.json > /dev/null; if [ -f /etc/alpine-release ]; then $SUDO rc-service docker restart 2>/dev/null || rc-service docker restart; elif command -v systemctl >/dev/null 2>&1 && systemctl --version >/dev/null 2>&1; then $SUDO mkdir -p /etc/systemd/system/docker.service.d; echo -e '[Service]\nExecStart=\nExecStart=/usr/bin/dockerd' | $SUDO tee /etc/systemd/system/docker.service.d/override.conf > /dev/null; $SUDO systemctl daemon-reload; $SUDO systemctl restart docker; elif command -v rc-service >/dev/null 2>&1; then $SUDO rc-service docker restart; else $SUDO service docker restart; fi; sleep 3; if netstat -tlnp 2>/dev/null | grep -q ":2375"; then LOCAL_IP=$(hostname -I | awk '{print $1}' 2>/dev/null || echo "localhost"); echo "? Success! Docker API: http://$LOCAL_IP:2375"; else echo "? Failed - check Docker logs"; exit 1; fi
